syntax = "proto3";

package z.api.v1;

service ApiService {
  rpc Check(CheckRequest) returns (CheckResponse);
	rpc Write(WriteRequest) returns (WriteResponse);
  rpc Namespaces(NamespacesRequest) returns (NamespacesResponse);
  rpc WriteNamespaceRelations(WriteNamespaceRelationsRequest) returns (WriteNamespaceRelationsResponse);
}

message Set {
	string namespace = 1;
	string id       = 2;
	string relation = 3;
}

message Tuple {
	Set parent = 1;
	Set child  = 2;
}

message Relation {
  repeated string permissions = 1;
}

message Namespace {
  map<string, Relation> relations = 1;
}

message CheckRequest {
  Set parent = 1;
  Set child = 2;
}

message CheckResponse {
  bool allowed = 1;
}

message WriteRequest {
  repeated Tuple adds = 1;
  repeated Tuple removes = 2;
}

message WriteResponse {}

message NamespacesRequest {}

message NamespacesResponse {
  map<string, Namespace> namespaces = 1;
}

message NamespaceRelation {
  string namespace = 1;
  string relation = 2;
  string permission = 3;
}

message WriteNamespaceRelationsRequest {
  repeated NamespaceRelation adds = 1;
  repeated NamespaceRelation removes = 2;
}

message WriteNamespaceRelationsResponse {}